<!doctype html>
<html lang="pt-br">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Ouvidoria CETEP LNAB</title>
    <!-- Carregando Bootstrap 5 e jQuery via CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    
    <style>
        /* Estilos base e dark theme (substituindo o style.css) */
        body {
            transition: background-color 0.3s, color 0.3s;
            background-color: #f8f9fa; /* Fundo claro padrão do Bootstrap */
        }
        .hidden {
            display: none !important;
        }
        .logo-box {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 1rem;
        }
        .logo-box img {
            margin-right: 10px;
        }

        /* Estilos do Tema Escuro */
        body.dark-theme {
            background-color: #121212;
            color: #e0e0e0;
        }
        body.dark-theme .card {
            background-color: #1e1e1e;
            border-color: #333;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.5) !important;
        }
        body.dark-theme h2, 
        body.dark-theme h4, 
        body.dark-theme .form-label, 
        body.dark-theme .text-end, 
        body.dark-theme .text-white {
            color: #ffffff !important;
        }
        body.dark-theme .form-control, body.dark-theme .form-select {
            background-color: #333;
            color: #fff;
            border-color: #444;
        }
        body.dark-theme .form-control:focus, body.dark-theme .form-select:focus {
            background-color: #333;
            color: #fff;
            border-color: #444;
            box-shadow: 0 0 0 0.25rem rgba(255, 255, 255, 0.25);
        }
        body.dark-theme .text-danger {
            color: #ff8a80 !important;
        }
        body.dark-theme .text-success {
            color: #69f0ae !important;
        }
        body.dark-theme .btn-outline-secondary {
            color: #e0e0e0;
            border-color: #e0e0e0;
        }
    </style>
</head>
<body>
    <div class="container mt-3">
        <header class="text-center">
            <div class="logo-box">
                <!-- Mantendo a URL de imagem que você forneceu -->
                <img src="https://i.im.ge/2025/04/11/pVTi0z.logo.png" alt="logo" height="50">
                <h2>Ouvidoria CETEP LNAB</h2>
            </div>
        </header>

        <div class="text-end mb-3">
            <button id="toggleTheme" class="btn btn-outline-secondary btn-sm">Tema Escuro</button>
        </div>

        <!-- Botões de Navegação (Menu) -->
        <div class="d-grid gap-2 col-10 col-md-8 mx-auto mb-4">
            <button class="btn btn-primary" onclick="mostrar('registro')">Registrar Manifestação</button>
            <button class="btn btn-secondary" onclick="mostrar('consulta')">Consultar por Protocolo</button>
            <button class="btn btn-info text-white" onclick="mostrar('consultaCPF')">Consultar por CPF</button>
            <button class="btn btn-warning text-white" onclick="mostrar('consultaMatricula')">Consultar por Matrícula</button> 
            <button class="btn btn-danger" onclick="mostrar('adminLogin')">Acesso do Administrador</button>
        </div>

        <!-- Formulário de Registro -->
        <div id="registro" class="card shadow-sm p-4 mb-4 hidden">
            <h4>Registrar Manifestação</h4>
            <form id="formRegistro">
                <div class="mb-3">
                    <label for="nome" class="form-label">Nome (opcional)</label>
                    <input type="text" id="nome" name="nome" class="form-control">
                </div>
                <div class="mb-3">
                    <label for="cpf" class="form-label">CPF</label>
                    <input type="text" id="cpf" name="cpf" class="form-control" placeholder="Apenas números" maxlength="11" required>
                </div>
                <div class="mb-3">
                    <label for="matricula" class="form-label">Matrícula</label>
                    <input type="text" id="matricula" name="matricula" class="form-control" placeholder="Apenas 8 números" maxlength="8" required>
                </div>
                
                <div class="mb-3">
                    <label for="tipo" class="form-label">Tipo de Manifestação</label>
                    <select id="tipo" name="tipo" class="form-select" required>
                        <option value="" disabled selected>Selecione...</option>
                        <option value="elogio">Elogio</option>
                        <option value="sugestao">Sugestão</option>
                        <option value="reclamacao">Reclamação</option>
                        <option value="denuncia">Denúncia</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label for="descricao" class="form-label">Descrição</label>
                    <textarea id="descricao" name="descricao" class="form-control" rows="3" required></textarea>
                </div>
                <button type="submit" class="btn btn-success">Enviar</button>
            </form>
        </div>

        <!-- Consulta por Protocolo -->
        <div id="consulta" class="card shadow-sm p-4 mb-4 hidden">
            <h4>Consultar por Protocolo</h4>
            <form id="formConsulta">
                <div class="mb-3">
                    <label for="protocolo" class="form-label">Protocolo</label>
                    <input type="text" id="protocolo" name="protocolo" class="form-control" required>
                </div>
                <button type="submit" class="btn btn-primary">Consultar</button>
            </form>
            <div id="resultadoConsulta" class="mt-3"></div>
        </div>

        <!-- Consulta por CPF -->
        <div id="consultaCPF" class="card shadow-sm p-4 mb-4 hidden">
            <h4>Consultar por CPF</h4>
            <form id="formConsultaCPF">
                <div class="mb-3">
                    <label for="cpfBusca" class="form-label">CPF</label>
                    <input type="text" id="cpfBusca" name="cpfBusca" class="form-control" placeholder="Apenas números" maxlength="11" required>
                </div>
                <button type="submit" class="btn btn-info text-white">Consultar</button>
            </form>
            <div id="resultadoConsultaCPF" class="mt-3"></div>
        </div>
        
        <!-- Consulta por Matrícula -->
        <div id="consultaMatricula" class="card shadow-sm p-4 mb-4 hidden">
            <h4>Consultar por Matrícula</h4>
            <form id="formConsultaMatricula">
                <div class="mb-3">
                    <label for="matriculaBusca" class="form-label">Matrícula</label>
                    <input type="text" id="matriculaBusca" name="matriculaBusca" class="form-control" placeholder="Apenas 8 números" maxlength="8" required>
                </div>
                <button type="submit" class="btn btn-warning text-white">Consultar</button>
            </form>
            <div id="resultadoConsultaMatricula" class="mt-3"></div>
        </div>

        <!-- Acesso do Administrador -->
        <div id="adminLogin" class="card shadow-sm p-4 mb-4 hidden">
            <h4>Acesso do Administrador</h4>
            <form id="formAdminLogin">
                <div class="mb-3">
                    <label for="usuarioAdmin" class="form-label">Usuário</label>
                    <input type="text" id="usuarioAdmin" name="usuarioAdmin" class="form-control" required>
                </div>
                <div class="mb-3">
                    <label for="senhaAdmin" class="form-label">Senha</label>
                    <input type="password" id="senhaAdmin" name="senhaAdmin" class="form-control" required>
                </div>
                <button type="submit" class="btn btn-danger">Entrar</button>
            </form>
            <div id="erroLogin" class="text-danger mt-2"></div>
        </div>

        <!-- Confirmação de Registro -->
        <div id="confirmacao" class="card shadow-sm p-4 mb-4 hidden text-center">
            <h4 class="text-success">Manifestação registrada com sucesso!</h4>
            <p id="protocoloGerado"></p>
            <button class="btn btn-primary" onclick="mostrar('registro')">Nova Manifestação</button>
            <button class="btn btn-secondary" onclick="mostrar('consulta')">Consultar Protocolo</button>
        </div>
    </div>

<script>
    // Função para mostrar a seção correta
    function mostrar(id){
        // Esconde todas as divs com a classe 'card' que contêm 'hidden'
        document.querySelectorAll('.card').forEach(d => d.classList.add('hidden'));
        // Exibe a div com o ID correspondente
        const targetElement = document.getElementById(id);
        if (targetElement) {
            targetElement.classList.remove('hidden');
        }
        // Limpa os resultados de consulta ao mudar a tela
        $('#resultadoConsulta').html('');
        $('#resultadoConsultaCPF').html('');
        $('#resultadoConsultaMatricula').html(''); 
    }
    
    // TEMA ESCURO
    const toggleThemeBtn = document.getElementById("toggleTheme");
    const body = document.body;
    toggleThemeBtn.addEventListener("click", () => {
        body.classList.toggle("dark-theme");
        toggleThemeBtn.textContent = body.classList.contains("dark-theme") ? "Tema Claro" : "Tema Escuro";
    });

    // FUNÇÃO PADRÃO PARA FORMATAR RESULTADOS (para CPF e Matrícula)
    function formatResults(data, targetDivId) {
        if (data.length === 0) $('#' + targetDivId).html('<p class="text-danger">Nenhuma manifestação encontrada.</p>');
        else {
            let html = '';
            data.forEach(d => {
                const respostaHtml = d.resposta 
                    ? `<p class="text-success"><strong>Resposta do Admin:</strong> ${d.resposta}</p>`
                    : '<p class="text-warning"><strong>Resposta do Admin:</strong> Pendente de análise.</p>';
                
                html += `
                <div class="border p-3 mb-2">
                    <p><strong>Protocolo:</strong> ${d.protocolo}</p>
                    <p><strong>Nome:</strong> ${d.nome || 'Anônimo'}</p>
                    <p><strong>CPF:</strong> ${d.cpf}</p>
                    <p><strong>Matrícula:</strong> ${d.matricula || 'Não informada'}</p> 
                    <p><strong>Tipo:</strong> ${d.tipo}</p>
                    <p><strong>Descrição:</strong> ${d.descricao}</p>
                    ${respostaHtml}
                </div>`;
            });
            $('#' + targetDivId).html(html);
        }
    }


    // 1. REGISTRO DE MANIFESTAÇÃO
    $('#formRegistro').on('submit', function(e){
        e.preventDefault();
        
        // Limpeza de campos para garantir apenas números antes do envio
        $('#cpf').val($('#cpf').val().replace(/[^0-9]/g, ''));
        $('#matricula').val($('#matricula').val().replace(/[^0-9]/g, '')); 
        
        $.post('/registrar', $(this).serialize(), function(data){
            $('#protocoloGerado').text('Protocolo: ' + data.protocolo);
            mostrar('confirmacao');
            $('#formRegistro')[0].reset(); // Limpa o formulário após sucesso
        }).fail(function(err){
            // Substituindo alert() por um modal ou mensagem na tela (boa prática)
            const errorMessage = err.responseJSON?.erro || 'Erro desconhecido ao registrar.';
            $('#formRegistro').before(`<div class="alert alert-danger" role="alert">${errorMessage}</div>`);
            setTimeout(() => $('.alert-danger').remove(), 5000);
        });
    });

    // 2. CONSULTA POR PROTOCOLO
    $('#formConsulta').on('submit', function(e){
        e.preventDefault();
        $.post('/consultar', $(this).serialize(), function(data){
            const respostaHtml = data.resposta 
                ? `<p class="text-success"><strong>Resposta do Admin:</strong> ${data.resposta}</p>`
                : '<p class="text-warning"><strong>Resposta do Admin:</strong> Pendente de análise.</p>';

            let html = `
                <div class="border p-3">
                    <p><strong>Protocolo:</strong> ${data.protocolo}</p>
                    <p><strong>Nome:</strong> ${data.nome || 'Anônimo'}</p>
                    <p><strong>CPF:</strong> ${data.cpf}</p>
                    <p><strong>Matrícula:</strong> ${data.matricula || 'Não informada'}</p>
                    <p><strong>Tipo:</strong> ${data.tipo}</p>
                    <p><strong>Descrição:</strong> ${data.descricao}</p>
                    ${respostaHtml}
                </div>`;
            $('#resultadoConsulta').html(html);
        }).fail(function(err){
            $('#resultadoConsulta').html('<p class="text-danger">' + (err.responseJSON?.erro || 'Erro desconhecido') + '</p>');
        });
    });

    // 3. CONSULTA POR CPF
    $('#formConsultaCPF').on('submit', function(e){
        e.preventDefault();
        // Limpeza do campo CPF
        $('#cpfBusca').val($('#cpfBusca').val().replace(/[^0-9]/g, '')); 
        
        $.post('/consultar_cpf', $(this).serialize(), function(data){
            formatResults(data, 'resultadoConsultaCPF');
        }).fail(function(err){
            $('#resultadoConsultaCPF').html('<p class="text-danger">' + (err.responseJSON?.erro || 'Erro desconhecido') + '</p>');
        });
    });

    // 4. CONSULTA POR MATRÍCULA
    $('#formConsultaMatricula').on('submit', function(e){
        e.preventDefault();
        // Limpeza do campo Matrícula
        $('#matriculaBusca').val($('#matriculaBusca').val().replace(/[^0-9]/g, ''));
        
        $.post('/consultar_matricula', $(this).serialize(), function(data){
            formatResults(data, 'resultadoConsultaMatricula');
        }).fail(function(err){
            $('#resultadoConsultaMatricula').html('<p class="text-danger">' + (err.responseJSON?.erro || 'Erro desconhecido') + '</p>');
        });
    });

    // 5. LOGIN ADMINISTRATIVO
    $('#formAdminLogin').on('submit', function(e){
        e.preventDefault();
        $.post('/admin_login', $(this).serialize(), function(data){
            if (data.redirect) window.location.href = data.redirect;
        }).fail(function(err){
            $('#erroLogin').text(err.responseJSON?.erro || 'Usuário ou senha incorretos');
        });
    });

    // Garante que apenas números sejam digitados em tempo real
    document.getElementById('cpf').oninput = (e) => e.target.value = e.target.value.replace(/[^0-9]/g, '');
    document.getElementById('matricula').oninput = (e) => e.target.value = e.target.value.replace(/[^0-9]/g, '');
    document.getElementById('cpfBusca').oninput = (e) => e.target.value = e.target.value.replace(/[^0-9]/g, '');
    document.getElementById('matriculaBusca').oninput = (e) => e.target.value = e.target.value.replace(/[^0-9]/g, '');
    
    // Mostra a tela de registro por padrão ao carregar a página
    window.onload = () => mostrar('registro');
</script>
</body>
</html>
